<!DOCTYPE html>
{% extends "dashboard/base.html" %}
{% load static %}
{% load timetags %}
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Patient Page{% endblock %} </title>
</head>
<body>

{% block content %}

<h2 style="margin-top: 10px">פרטים אישיים</h2>
<div class="jumbotron">
    <div class="patient_details">
        <div class="grid-container">
            <p><span>שם : </span> {{patient_details.name}}</p>
            <p><span>תעודת זהות : </span> {{patient_details.id}}</p>
            <p><span> תאריך לידה : </span> {{patient_details.birthDate.time}}</p>
            <p><span>מרפאה : </span> {{patient_details.clinicName}}</p>
            <p><span>ארץ לידה : </span> {{patient_details.birthCountry}}</p>
        </div>
    </div>
</div>

<h2>תרופות</h2>
<div class="jumbotron container">
    <table class="table table-striped table-sm" style="background-color: white">
        <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">שם</th>
            <th scope="col">מינון</th>
        </tr>
        </thead>
        <tbody>
        {% for medicine in patient_medications %}
        <tr>
            <th scope="row">#</th>
            <td>{{medicine.val.name}}</td>
            <td>{{medicine.val.dosage}}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<h2>שאלון <span>מעודכן לתאריך {{patient_questionnaire.answeredAt.time|prettydate}} </span></h2>
<div class="jumbotron">
    {% for question in patient_questionnaire.questionList %}
    <p><span> {{question.title}} </span>:
        {% for ans in question.ansPositions %}
        {% if ans == 0 %}
        {{question.choices.0}}
        {% elif ans == 1 %}
        {{question.choices.1}}
        {% elif ans == 2 %}
        {{question.choices.2}}
        {% elif ans == 3 %}
        {{question.choices.3}}
        {% endif %}
        {% endfor %}</p>
    {{question.answer}}
    {% endfor %}
</div>

<h2>דיווחים</h2>
<!--<div class="jumbotron">-->
<!--    {% for report in patient_reports %}-->
<!--    <p><span id="date">תאריך : </span> {{report.val.reportTime.time|prettydate}}-->
<!--        <span>סטאטוס : </span> {{report.val.status}}</p>-->
<!--    {% endfor %}-->
<!--</div>-->

<div class="jumbotron" style="background-color: white">
    <canvas id="myChart" width="400" height="150"></canvas>
</div>

<script>
    const ctx = document.getElementById('myChart').getContext('2d');
    <!-- Colors for chart -->
    const coloR = [];
    const dynamicColors = function () {
        const r = Math.floor(Math.random() * 255);
        const g = Math.floor(Math.random() * 255);
        const b = Math.floor(Math.random() * 255);
        return "rgb(" + r + "," + g + "," + b + "," + 0.6 + ")";
    };
    {% for label in labels %}
    coloR.push(dynamicColors());
    {% endfor %}
    <!-- Colors for chart end -->

    const yLabels = {
        0: 'Hallucinations',
        2: 'Off',
        4: 'On',
        6: 'Dyskinesia',
    };
    const myChart = new Chart(ctx, {
        type: 'line',
        data: {
            // Everything is ok! it's working still
            labels: [{% for label in labels %}'{{label}}',{% endfor %}],
    datasets: [{
        label: 'סטאטוס',
        data: [{% for val in data %}'{{val}}', {% endfor %}],
        backgroundColor: coloR,
        borderColor: coloR,
        borderWidth: 1}]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true,
                    suggestedMin: -2,
                    suggestedMax: 8,
                    callback: function (value) {
                        return yLabels[value];
                    }
                }
            }]
        }
    }
    });
</script>

{% endblock %}

</body>
</html>